"use strict";var v=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var o in t)v(e,o,{get:t[o],enumerable:!0})},U=(e,t,o,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of $(t))!G.call(e,s)&&s!==o&&v(e,s,{get:()=>t[s],enumerable:!(d=V(t,s))||d.enumerable});return e};var Y=e=>U(v({},"__esModule",{value:!0}),e);var z={};Q(z,{default:()=>_});module.exports=Y(z);var p=require("@raycast/api"),I=require("react");var S=require("@raycast/api"),m=require("react");function b(){let[e,t]=(0,m.useState)([]),[o,d]=(0,m.useState)(!0);(0,m.useEffect)(()=>{(async()=>{let n=await S.LocalStorage.getItem("history");n&&t(r=>[...r,...JSON.parse(n)]),d(!1)})()},[]),(0,m.useEffect)(()=>{S.LocalStorage.setItem("history",JSON.stringify(e))},[e]);let s=(0,m.useCallback)(async n=>{t([...e,n])},[t,e]),f=(0,m.useCallback)(async n=>{let r=await(0,S.showToast)({title:"Removing answer...",style:S.Toast.Style.Animated}),i=e.filter(h=>h.id!==n.id);t(i),r.title="Answer removed!",r.style=S.Toast.Style.Success},[t,e]),A=(0,m.useCallback)(async()=>{let n=await(0,S.showToast)({title:"Clearing history...",style:S.Toast.Style.Animated});t([]),n.title="History cleared!",n.style=S.Toast.Style.Success},[t]);return(0,m.useMemo)(()=>({data:e,isLoading:o,add:s,remove:f,clear:A}),[e,o,s,f,A])}var a=require("@raycast/api"),C=require("react/jsx-runtime");var P=e=>(0,C.jsx)(a.Action.CopyToClipboard,{icon:a.Icon.CopyClipboard,...e}),x=({onAction:e,title:t,modifiers:o})=>(0,C.jsx)(a.Action,{icon:a.Icon.Star,title:t,onAction:e,shortcut:{modifiers:o,key:"s"}}),T=({text:e,name:t})=>(0,C.jsx)(a.Action.CreateSnippet,{icon:a.Icon.Snippets,title:"Save as a Snippet",snippet:{text:e,name:t},shortcut:{modifiers:["cmd"],key:"n"}}),D=({icon:e=a.Icon.Trash,title:t,dialog:o,onAction:d,shortcut:s={modifiers:["ctrl"],key:"x"}})=>(0,C.jsx)(a.Action,{style:a.Action.Style.Destructive,icon:e,title:t,onAction:async()=>{await(0,a.confirmAlert)({title:o.title??t,message:o.message??"This action cannot be undone",icon:e,primaryAction:{title:o.primaryButton??t,style:a.Alert.ActionStyle.Destructive,onAction:d}})},shortcut:s});var k=require("@raycast/api");var w=require("react/jsx-runtime"),H=({question:e,answer:t})=>(0,w.jsxs)(k.ActionPanel.Section,{title:"Copy",children:[(0,w.jsx)(P,{title:"Copy Answer",content:t}),(0,w.jsx)(P,{title:"Copy Question",content:e})]});var u=require("@raycast/api"),L=require("react/jsx-runtime"),q=()=>(0,L.jsx)(u.ActionPanel.Section,{title:"Preferences",children:(0,L.jsx)(u.Action,{icon:u.Icon.Gear,title:"Open Extension Preferences",onAction:u.openExtensionPreferences})});var O=require("@raycast/api");var g=require("react/jsx-runtime"),E=({onSaveConversationAction:e,onSaveAnswerAction:t,snippet:o})=>(0,g.jsxs)(O.ActionPanel.Section,{title:"Save",children:[e&&(0,g.jsx)(x,{title:"Save Conversation",onAction:e,modifiers:["cmd"]}),(0,g.jsx)(x,{title:"Save Answer",onAction:t,modifiers:e?["cmd","shift"]:["cmd"]}),o&&(0,g.jsx)(T,{text:o.text,name:o.name})]});var N=require("@raycast/api"),K=require("react/jsx-runtime"),J=e=>{let{chat:t,streamData:o}=e,d=o&&o.id===t.id,s=`**${t.question}**

${d?o.answer:t.answer}`;return(0,K.jsx)(N.List.Item.Detail,{markdown:s})};var c=require("@raycast/api"),y=require("react");function R(){let[e,t]=(0,y.useState)([]),[o,d]=(0,y.useState)(!0);(0,y.useEffect)(()=>{(async()=>{let n=await c.LocalStorage.getItem("savedChats");n&&t(r=>[...r,...JSON.parse(n)]),d(!1)})()},[]),(0,y.useEffect)(()=>{c.LocalStorage.setItem("savedChats",JSON.stringify(e))},[e]);let s=(0,y.useCallback)(async n=>{let r=await(0,c.showToast)({title:"Saving your answer...",style:c.Toast.Style.Animated}),i={...n,saved_at:new Date().toISOString()};t([...e,i]),r.title="Answer saved!",r.style=c.Toast.Style.Success},[t,e]),f=(0,y.useCallback)(async n=>{let r=await(0,c.showToast)({title:"Unsaving your answer...",style:c.Toast.Style.Animated}),i=e.filter(h=>h.id!==n.id);t(i),r.title="Answer unsaved!",r.style=c.Toast.Style.Success},[t,e]),A=(0,y.useCallback)(async()=>{let n=await(0,c.showToast)({title:"Clearing your saved answers...",style:c.Toast.Style.Animated});t([]),n.title="Saved answers cleared!",n.style=c.Toast.Style.Success},[t]);return(0,y.useMemo)(()=>({data:e,isLoading:o,add:s,remove:f,clear:A}),[e,o,s,f,A])}var l=require("react/jsx-runtime");function _(){let e=R(),t=b(),[o,d]=(0,I.useState)(""),[s,f]=(0,I.useState)(null),A=i=>(0,l.jsxs)(p.ActionPanel,{children:[(0,l.jsx)(H,{answer:i.answer,question:i.question}),(0,l.jsx)(E,{onSaveAnswerAction:()=>e.add(i)}),(0,l.jsxs)(p.ActionPanel.Section,{title:"Delete",children:[(0,l.jsx)(D,{title:"Remove",dialog:{title:"Are you sure you want to remove this answer from your history?"},onAction:()=>t.remove(i)}),(0,l.jsx)(D,{title:"Clear History",dialog:{title:"Are you sure you want to clear your history?"},onAction:()=>t.clear(),shortcut:{modifiers:["cmd","shift"],key:"delete"}})]}),(0,l.jsx)(q,{})]}),r=t.data.sort((i,h)=>new Date(h.created_at??0).getTime()-new Date(i.created_at??0).getTime()).filter((i,h,B)=>h===B.findIndex(M=>M.id===i.id)).filter(i=>o===""?!0:i.question.toLowerCase().includes(o.toLowerCase())||i.answer.toLowerCase().includes(o.toLowerCase()));return(0,l.jsx)(p.List,{isShowingDetail:r.length!==0,isLoading:t.isLoading,filtering:!1,throttle:!1,selectedItemId:s||void 0,onSelectionChange:i=>{i!==s&&f(i)},searchBarPlaceholder:"Search answer/question...",searchText:o,onSearchTextChange:d,children:t.data.length===0?(0,l.jsx)(p.List.EmptyView,{title:"No history",description:"Your recent questions will be showed up here",icon:p.Icon.Stars}):(0,l.jsx)(p.List.Section,{title:"Recent",subtitle:r.length.toLocaleString(),children:r.map(i=>(0,l.jsx)(p.List.Item,{id:i.id,title:i.question,accessories:[{text:new Date(i.created_at??0).toLocaleDateString()}],detail:(0,l.jsx)(J,{chat:i}),actions:i&&s===i.id?A(i):void 0},i.id))})})}
